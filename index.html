<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>√öltimo Nivel</title>
  <style>
    :root{
      --bg:#06110d;         /* verde oscuro profundo */
      --panel:#081a14;      /* panel */
      --ink:#e7fff4;        /* texto */
      --muted:#b7d9c9;      /* texto suave */
      --line:#0e2f25;       /* borde */
      --accent:#31c48d;     /* verde bonito */
      --accent2:#0ea5a5;    /* toque teal */
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 700px at 50% 35%, #0a2a1f 0%, var(--bg) 55%, #030a07 100%);
      color:var(--ink);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .shell{
      width:min(720px, 100%);
      display:flex; flex-direction:column; gap:14px;
      align-items:center;
    }
    .card{
      width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:20px;
      padding:22px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(8px);
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-bottom:10px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent); box-shadow:0 0 18px rgba(49,196,141,.55);}
    h1{margin:0 0 10px; font-size:22px; letter-spacing:.2px;}
    p{margin:10px 0; line-height:1.55; font-size:16px; color:var(--ink);}
    .muted{color:var(--muted); font-size:14px}
    .btns{display:grid; gap:10px; margin-top:16px;}
    button{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(49,196,141,.14);
      color:var(--ink);
      padding:13px 14px;
      border-radius:14px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:hover{background: rgba(49,196,141,.20); border-color:#1f5a45}
    button:active{transform: translateY(1px)}
    button.secondary{
      background: transparent;
      color:var(--muted);
    }
    button.secondary:hover{border-color:#1f5a45; background: rgba(255,255,255,.03); color:var(--ink)}
    .input{
      width:100%;
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--ink);
      outline:none;
      font-size:16px;
    }
    .input:focus{border-color:#1f5a45; box-shadow:0 0 0 4px rgba(49,196,141,.15)}
    .pillrow{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .pill{
      border:1px solid var(--line);
      background: rgba(14,47,37,.45);
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      user-select:none;
    }
    .hint{margin-top:10px; font-size:13px; color:var(--muted)}
    .ok{color:#7CFCB2; font-weight:800}
    .no{color:#ffb3b3; font-weight:800}
    .divider{height:1px; background: var(--line); margin:14px 0}
    a{color:var(--accent); text-decoration:none}
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="topbar">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="dot"></div>
          <div id="progress">Pantalla 1</div>
        </div>
        <div id="tag">√öltimo nivel</div>
      </div>

      <h1 id="title"></h1>
      <div id="content"></div>

      <div class="btns" id="btns"></div>
    </div>
  </div>

<script>
/* =========================
   CONFIG R√ÅPIDA (EDITA AQU√ç)
   ========================= */
const NAME = "Mayra";
const YOU  = "Dani";

/* =========================
   MOTOR DEL JUEGO
   ========================= */
const state = {
  step: 0,
  key: null,       // clave final derivada del juego
  score: 0,
  attempt: 0
};

function el(id){ return document.getElementById(id); }

function normalize(s){
  return (s||"")
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")  // quita acentos
    .replace(/[^\w\s]/g,"")                          // quita signos
    .replace(/\s+/g," ")
    .trim();
}

// Peque√±o hash ‚Äúhumano‚Äù: genera una clave de 4 letras a partir de una frase
function makeKey(phrase){
  const n = normalize(phrase);
  let sum = 0;
  for (let i=0;i<n.length;i++){
    sum = (sum + n.charCodeAt(i) * (i+1)) % 10000;
  }
  const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ"; // sin I/O para que no confunda
  const a = letters[(sum      ) % letters.length];
  const b = letters[(sum >> 2 ) % letters.length];
  const c = letters[(sum >> 4 ) % letters.length];
  const d = letters[(sum >> 6 ) % letters.length];
  return `${a}${b}${c}${d}`;
}

const steps = [
  {
    tag: "Inicio",
    title: `Hola, ${NAME}.`,
    html: `
      <p class="muted">Minimal. Sin ruido. Como se siente esto.</p>
      <p>Si llegaste aqu√≠ es porque confiaste en m√≠ un ratito.</p>
      <p>Este es un juego corto‚Ä¶ pero <b>s√≠ est√° m√°s ‚Äúsmart‚Äù</b>. üòå</p>
      <div class="divider"></div>
      <p class="muted">Reglas:</p>
      <p class="muted">1) No te saltes nada.<br>2) Si te atoras, hay pista.<br>3) El final vale la pena.</p>
    `,
    buttons: [{ text:"Empezar", next:1 }]
  },

  // NIVEL 1: l√≥gica / patr√≥n
  {
    tag: "Nivel 1",
    title: "Patr√≥n",
    html: `
      <p>Elige la opci√≥n que completa la secuencia:</p>
      <p><b>2 ‚Äî 3 ‚Äî 5 ‚Äî 8 ‚Äî 13 ‚Äî ?</b></p>
      <p class="muted">No te preocupes, no es examen. Solo quiero ver si eres team ‚Äúcerebrito‚Äù üòè</p>
      <div id="feedback" class="hint"></div>
    `,
    buttons: [
      { text:"21", action: () => correct(2, "Bien üòå") },
      { text:"20", action: () => wrong("Casi. Piensa en sumar los dos anteriores.") },
      { text:"18", action: () => wrong("Nope. Pista: 2+3=5, 3+5=8‚Ä¶") },
      { text:"Pista", action: () => hint("Es Fibonacci: cada n√∫mero es la suma de los dos anteriores.") , secondary:true}
    ]
  },

  // NIVEL 2: anagrama/ordenar palabras
  {
    tag: "Nivel 2",
    title: "Orden",
    html: `
      <p>Ordena mentalmente estas 4 palabras para formar una frase que tenga sentido:</p>
      <div class="pillrow">
        <div class="pill">contigo</div>
        <div class="pill">paz</div>
        <div class="pill">se</div>
        <div class="pill">siente</div>
      </div>
      <input class="input" id="ans2" placeholder="Escr√≠belo aqu√≠‚Ä¶" autocomplete="off" />
      <div id="feedback" class="hint"></div>
    `,
    buttons: [
      { text:"Comprobar", action: check2 },
      { text:"Pista", action: () => hint("Empieza con: ‚ÄúSe‚Ä¶‚Äù") , secondary:true}
    ]
  },

  // NIVEL 3: clave derivada (m√°s ‚Äúsmart‚Äù)
  {
    tag: "Nivel 3",
    title: "Clave",
    html: `
      <p>Ok. √öltima prueba antes del final.</p>
      <p class="muted">Te voy a pedir una frase corta. Con esa frase el juego genera una clave.</p>
      <p><b>Escribe una frase de 4 a 8 palabras que describa lo que se siente estar juntos.</b></p>
      <input class="input" id="ans3" placeholder="Ej: 'Se siente f√°cil, bonito y real'‚Ä¶" autocomplete="off" />
      <div id="keybox" class="hint"></div>
      <div id="feedback" class="hint"></div>
    `,
    buttons: [
      { text:"Generar clave", action: genKey },
      { text:"Pista", action: () => hint("Puede ser algo como: ‚ÄúSe siente natural y en paz‚Äù.") , secondary:true}
    ]
  },

  // VALIDACI√ìN CLAVE (m√°s dif√≠cil)
  {
    tag: "Checkpoint",
    title: "Verificaci√≥n",
    html: `
      <p>Ahora escribe la <b>clave</b> que te sali√≥ (4 letras). üòå</p>
      <input class="input" id="ans4" placeholder="ABCD" autocomplete="off" />
      <div id="feedback" class="hint"></div>
      <p class="muted">S√≠, lo s√©‚Ä¶ soy extra. Pero es parte del encanto.</p>
    `,
    buttons: [
      { text:"Entrar", action: check4 },
      { text:"Volver a ver clave", action: () => go(3), secondary:true }
    ]
  },

  // FUERA DE JUEGO (rom√°ntico suave)
  {
    tag: "Fuera de juego",
    title: "Ok‚Ä¶ ya en serio.",
    html: `
      <p>Gracias por jugarlo de verdad.</p>
      <p>La neta‚Ä¶ me gusta c√≥mo se siente estar contigo. Se siente <b>f√°cil</b>, se siente <b>bonito</b>, se siente <b>real</b>.</p>
      <p>No quiero correr ni hacer un show. Solo quer√≠a decirte esto de una forma que se sintiera <i>nuestra</i>.</p>
    `,
    buttons: [{ text:"Siguiente", next:6 }]
  },

  // FINAL
  {
    tag: "Final",
    title: "√öltimo nivel",
    html: `
      <p class="muted">Respira.</p>
      <p style="font-size:18px"><b>${NAME}‚Ä¶ ¬øquieres ser mi novia?</b></p>
    `,
    buttons: [
      { text:"S√≠ üíö", next:7 },
      { text:"Obvio s√≠ üòå", next:7 }
    ]
  },

  // CELEBRACI√ìN
  {
    tag: "‚úÖ",
    title: "Checkpoint desbloqueado",
    html: `
      <p class="ok">Logro desbloqueado: <b>Novios</b> üíö</p>
      <p class="muted">Recompensa:</p>
      <p>1) Abrazo<br>2) Beso<br>3) Seguimos escribiendo esto‚Ä¶ con calma y con intenci√≥n.</p>
      <div class="divider"></div>
      <p class="muted">Fin del juego. Inicio de lo bueno.</p>
    `,
    buttons: [{ text:"Fin", action: () => alert("üíö") }]
  }
];

function render(){
  const s = steps[state.step];
  el("progress").textContent = `Pantalla ${state.step+1} / ${steps.length}`;
  el("tag").textContent = s.tag || "";
  el("title").textContent = s.title || "";
  el("content").innerHTML = s.html || "";

  const btns = el("btns");
  btns.innerHTML = "";
  (s.buttons||[]).forEach(b=>{
    const btn = document.createElement("button");
    btn.textContent = b.text;
    if (b.secondary) btn.classList.add("secondary");
    btn.onclick = b.action ? b.action : () => go(b.next);
    btns.appendChild(btn);
  });
}

function go(n){
  state.step = n;
  render();
}

function hint(msg){
  const fb = el("feedback");
  if (fb) fb.innerHTML = `üí° ${msg}`;
}

function wrong(msg){
  state.attempt++;
  const fb = el("feedback");
  if (fb) fb.innerHTML = `<span class="no">Nope.</span> ${msg}`;
}

function correct(nextStep, msg){
  state.score++;
  const fb = el("feedback");
  if (fb) fb.innerHTML = `<span class="ok">Bien.</span> ${msg}`;
  setTimeout(()=>go(nextStep), 450);
}

/* ========== NIVEL 2 ========== */
function check2(){
  const ans = normalize(el("ans2").value);
  // aceptamos variaciones razonables
  const ok = (ans === "se siente paz contigo") || (ans === "se siente paz contigo") ||
             (ans === "se siente contigo paz") || (ans.includes("se siente") && ans.includes("contigo") && ans.includes("paz"));
  if (ok) correct(3, "Eso. ü´∂");
  else wrong("Intenta que suene como una frase real.");
}

/* ========== NIVEL 3 ========== */
function genKey(){
  const phrase = el("ans3").value || "";
  const n = normalize(phrase);
  if (n.split(" ").filter(Boolean).length < 4){
    wrong("Pon una frase de m√≠nimo 4 palabras.");
    return;
  }
  state.key = makeKey(phrase);
  const box = el("keybox");
  box.innerHTML = `Tu clave: <b style="letter-spacing:.25em;color:var(--accent)">${state.key}</b>`;
  el("feedback").innerHTML = `<span class="ok">Listo.</span> Ahora guarda esa clave.`;
  setTimeout(()=>go(4), 900);
}

/* ========== CHECKPOINT ========== */
function check4(){
  const ans = normalize(el("ans4").value).toUpperCase();
  const fb = el("feedback");
  if (!state.key){
    fb.innerHTML = `<span class="no">Ups.</span> Primero genera la clave.`;
    return;
  }
  // m√°s estricto: debe ser exacta
  if (ans === state.key){
    fb.innerHTML = `<span class="ok">Acceso concedido.</span>`;
    setTimeout(()=>go(5), 500);
  } else {
    wrong("Clave incorrecta. Vuelve a la anterior si quieres verla otra vez.");
  }
}

render();
</script>
</body>
</html>
